---
outline: [2,3]
---

# çº¿ä¸Šéƒ¨ç½²(v3)

:::danger ï¼ï¼ï¼æ¨èä½¿ç”¨`Linux`ç³»æœåŠ¡å™¨ï¼ï¼ï¼
ä¸‹é¢çš„æ‰€æœ‰æ“ä½œï¼Œå‡åœ¨ `Linux` ä¸Šè¿›è¡Œï¼Œå¦‚æœæœºå™¨æ˜¯è£…çš„`windows server` éƒ¨åˆ†æ“ä½œå¯èƒ½éœ€è¦è¿œç¨‹æ¡Œé¢è¿›è¡Œ

ğŸ‘‰ğŸ» **[å®å¡”é¢æ¿å®˜æ–¹å®‰è£…æ•™ç¨‹](https://www.bt.cn/)** ğŸ‘ˆğŸ»
:::

## 1 é…ç½®æœºå™¨ç¯å¢ƒ

### 1.1 å®‰è£…å®å¡”é¢æ¿

è¯¦è§ ğŸ‘‰ğŸ» **[å®å¡”é¢æ¿å®˜æ–¹å®‰è£…æ•™ç¨‹](https://www.bt.cn/)** ğŸ‘ˆğŸ»

### 1.2 å®‰è£…å¿…è¦çš„è½¯ä»¶

**ä¸€å®šè¦ç¡®è®¤å®‰è£…å®Œæ¯•! é‡è¦çš„äº‹æƒ…è¯´ä¸‰é**

**ä¸€å®šè¦ç¡®è®¤å®‰è£…å®Œæ¯•! é‡è¦çš„äº‹æƒ…è¯´ä¸‰é**

**ä¸€å®šè¦ç¡®è®¤å®‰è£…å®Œæ¯•! é‡è¦çš„äº‹æƒ…è¯´ä¸‰é**

å¿…å¤‡çš„**6**ä¸ªè½¯ä»¶åˆ—è¡¨

- Nginx æˆ– Apache (ä¼˜å…ˆæ¨è Nginx)
- æ•°æ®åº“
  - redis
  - mysql
  - MongoDB

* PHPï¼ˆmysqlæ•°æ®åº“ç®¡ç†å·¥å…·éœ€è¦çš„ç¯å¢ƒï¼‰
* phpMyAdminï¼ˆmysqlæ•°æ®åº“ç®¡ç†å·¥å…·ï¼‰

**æ³¨æ„ï¼Œè¿™é‡Œçš„è½¯ä»¶éœ€è¦è‡ªå·±åœ¨å®å¡”ç®¡ç†è½¯ä»¶åˆ—è¡¨æ‰‹åŠ¨å®‰è£…**

é€šè¿‡å®å¡”é¢æ¿æä¾›çš„è½¯ä»¶å•†åº—è¿›è¡Œå®‰è£…

![](https://img.cdn.sugarat.top/mdImg/MTY0NzQ4MzMwMzg2OQ==647483303869)

å®‰è£…å®Œåï¼Œå¯ä»¥æŠŠå¸¸ç”¨çš„åŠ è‡³é¦–é¡µ

![](https://img.cdn.sugarat.top/mdImg/MTY0NzQ4MzM3ODE4Mw==647483378183)

:::details è…¾è®¯äº‘ å®å¡” MongoDB å®‰è£…å¤±è´¥
å‚è€ƒ https://www.bt.cn/bbs/thread-134959-1-1.html è§£å†³
:::

### 1.3 å®‰è£…Node

ä½¿ç”¨ Node ç®¡ç†é¢æ¿å®‰è£…`Node`

:::tip æ¸©é¦¨æç¤º (é‡è¦çš„äº‹æƒ…è¯´ 3 é)
å»ºè®®å®‰è£…`Node 18`(å¤§äºç­‰äº`18.16.0`ç‰ˆæœ¬)

å»ºè®®å®‰è£…`Node 18`(å¤§äºç­‰äº`18.16.0`ç‰ˆæœ¬)

å»ºè®®å®‰è£…`Node 18`(å¤§äºç­‰äº`18.16.0`ç‰ˆæœ¬)
:::

:::details Node å„ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸ

æ•°æ®æ¥æºï¼šhttps://github.com/nodejs/Release/blob/main/README.md

![](https://img.cdn.sugarat.top/mdImg/MTY4MzExNTA4NTcyNw==683115085727)
:::

å®‰è£…è·¯å¾„ï¼šç½‘ç«™ => Node é¡¹ç›®

å…ˆå®‰è£… Node ç‰ˆæœ¬ç®¡ç†é¢æ¿

![](https://cdn.upyun.sugarat.top/mdImg/sugar/048ab2d782153e2c8bd754ff8520ecc9)

é€šè¿‡ Node ç‰ˆæœ¬ç®¡ç†å™¨å®‰è£…éœ€è¦çš„ Node ç‰ˆæœ¬

![](https://cdn.upyun.sugarat.top/mdImg/sugar/5bec8f7f510d0c772349a9f3f495c274)

æˆ‘è¿™é‡Œå°±é€‰æ‹©å½“ä¸‹æœ€æ–°çš„ç¨³å®šç‰ˆå’¯`v22.11.0`

ç„¶åè®¾ç½®å‘½ä»¤è¡Œç‰ˆæœ¬ä¸ºå½“å‰å®‰è£…çš„ç‰ˆæœ¬

![](https://cdn.upyun.sugarat.top/mdImg/sugar/d9586caeb2b19c634c125e668aa83c37)

:::tip æ¸©é¦¨æç¤º
æœ¬æ–‡çš„æ‰€æœ‰`shell`æŒ‡ä»¤æ— ç‰¹æ®Šè¯´æ˜ï¼Œéƒ½æ˜¯åœ¨å®å¡”é¢æ¿çš„ç»ˆç«¯å·¥å…·ä¸­è¿è¡Œ
:::

æµ‹è¯•æ˜¯å¦æ­£å¸¸å®‰è£…`Node.js`ï¼Œç»ˆç«¯å·¥å…·è¿è¡Œå¦‚ä¸‹æŒ‡ä»¤

```sh
node -v
```

æœ‰å¦‚ä¸‹æ˜¾ç¤ºè¡¨æ˜å®‰è£…æˆåŠŸ

![](https://cdn.upyun.sugarat.top/mdImg/sugar/9a16f766e47b723bdc304c06f6b4aa57)

:::details æç¤ºæ²¡æœ‰ node æŒ‡ä»¤?
å¦‚æœæç¤ºæ²¡æœ‰ node æŒ‡ä»¤ï¼Œå¯æ‰‹åŠ¨å‘ `~/.bashrc` æ–‡ä»¶æ·»åŠ å¦‚ä¸‹é…ç½®

```sh
export PATH=$PATH:/www/server/nodejs/å®é™…å®‰è£…ç‰ˆæœ¬/bin
```

:::

:::details (æ—§) é€šè¿‡ PM2 å®‰è£… Node
![](https://img.cdn.sugarat.top/mdImg/MTY0NzQ4MzQ0MjUzMg==647483442532)
:::

### 1.4 å®‰è£…è¾…åŠ©CLIå·¥å…·

æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤å®‰è£…

```sh
npm i -g @sugarat/cli --registry=https://registry.npmmirror.com
```

å®‰è£…å®Œåä½ å°†å¾—åˆ°ä¸€ä¸ª `q` æŒ‡ä»¤ï¼Œæ‰§è¡Œ `q --version` å³å¯æŸ¥è¯¢ç‰ˆæœ¬æƒ…å†µ

```sh
q --version
```

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5MTIwODU5Ng==676791208596)

æœ‰ç‰ˆæœ¬ä¿¡æ¯è¡¨æ˜å®‰è£…æˆåŠŸ

ç´§æ¥ç€é€šè¿‡`q`æŒ‡ä»¤å®‰è£… `@sugarat/cli-plugin-ep` æ’ä»¶

**åç»­å¤§éƒ¨åˆ†éƒ¨ç½²å·¥ä½œç”±æ­¤æ’ä»¶æä¾›æ”¯æŒ**

```sh
q add ep
```

åç»­æ›´æ–°æ’ä»¶åªéœ€è¦æ‰§è¡Œ

```sh
q update
```

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5MTQyNjExOQ==676791426119)

:::tip q add ep æ‰§è¡Œç»“æœç¤ºä¾‹

```sh
ğŸŒ© æ­£åœ¨å®‰è£…æ’ä»¶ @sugarat/cli-plugin-ep ï¼Œè¯·ç¨ç­‰
å®Œæˆ ep æŒ‡ä»¤å®‰è£… 0.1.1
æ‰§è¡Œ q ep --help æŸ¥çœ‹ç»†èŠ‚
```

:::

### 1.5 åˆå§‹åŒ– Node ç›¸å…³ç¯å¢ƒ

:::tip æ¸©é¦¨æç¤º
å¯é‡å¤æ‰§è¡Œï¼Œç”¨äºæ£€æŸ¥ç¯å¢ƒï¼Œä¸ä¼šé‡å¤å®‰è£…å·²æœ‰åº“

ä¸‹è¿°æ–¹å¼é€‰æ‹©å…¶ä¸€å³å¯
:::

æ‰‹åŠ¨æ‰§è¡Œ shell æŒ‡ä»¤å®‰è£…ï¼Œç¨³å®šä¸å‡ºé”™

```sh
# è®¾ç½®é•œåƒæºä¸º npm å›½å†…é•œåƒæº
npm config set registry https://registry.npmmirror.com/

# å®‰è£… nrm
npm i -g nrm

# å®‰è£… pnpm
npm i -g pnpm

# å®‰è£… pm2
npm i -g pm2
```

:::details æˆ‘ç›¸çŸ¥é“ï¼Œè¿™äº›åº“æ˜¯å¹²å˜›çš„?

- [node](https://nodejs.org/zh-cn/): `JavaScript` æœåŠ¡ç«¯è¿è¡Œæ—¶
- [nrm](https://github.com/Pana/nrm): `npm` é•œåƒæºåˆ‡æ¢å·¥å…·
- [pnpm](https://pnpm.io/zh/): å¿«é€Ÿçš„ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´çš„åŒ…ç®¡ç†å·¥å…·
- [pm2](https://pm2.keymetrics.io/): å®ˆæŠ¤è¿›ç¨‹ç®¡ç†å·¥å…·
  :::

**å¦‚æœåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜æˆ–åç»­å¯åŠ¨æœåŠ¡æ—¶å‡ºç°é—®é¢˜ï¼Œå¯è¿›è¡Œé‡æ–°å®‰è£…**

_å¦‚é‡è§£å†³ä¸äº†çš„é—®é¢˜ï¼Œå¯åŠ ç¾¤åé¦ˆ_

## 2 åˆ›å»ºç½‘ç«™

### 2.1 åˆ›å»ºç«™ç‚¹å’Œæ•°æ®åº“

ç‚¹å‡»`æ·»åŠ ç«™ç‚¹`

![](https://img.cdn.sugarat.top/mdImg/MTY0NzYxMzAzMTExMg==647613031112)

**â‘  è¾“å…¥è¦ç»‘å®šçš„åŸŸå â‘¡ åˆ›å»ºæ•°æ®åº“ â‘¢ è‡ªå®šä¹‰æ•°æ®åº“è´¦å· â‘£ é€‰æ‹©çº¯é™æ€**

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5MjE4MzgyNg==676792183826)

æ•°æ®å¡«å†™å®Œæ¯•ï¼Œç‚¹å‡»æäº¤å³å¯ï¼Œç„¶åä¼šè‡ªåŠ¨å¸®åŠ©åˆ›å»ºç½‘ç«™ç›¸å…³ç›®å½•ï¼Œå¹¶å‘ŠçŸ¥å…³è”æ•°æ®åº“è´¦å·å’Œå¯†ç 

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5MjQyMDM5Mg==676792420392)

**è®°å¾—å¤åˆ¶ä¿å­˜ä¸€ä¸‹ï¼Œåé¢ä¼šç”¨ä¸Šï¼ï¼**

**è®°å¾—å¤åˆ¶ä¿å­˜ä¸€ä¸‹ï¼Œåé¢ä¼šç”¨ä¸Šï¼ï¼**

:::tip æˆ‘æ²¡æœ‰åŸŸåæ€ä¹ˆåŠï¼Ÿ
æ²¡æœ‰åŸŸåå¯ä»¥ [è”ç³»æˆ‘](./../author.md)ï¼Œç»™ä½ ç»‘å®šä¸ª`sugarat.top`ä¸‹çš„3||4çº§åŸŸå

- ä¾‹å¦‚ï¼šhttps://ep.test.sugarat.top
- ä¾‹å¦‚ï¼šhttps://ep.dev.sugarat.top
  :::

:::details æˆ‘æƒ³ç”¨ip+ç«¯å£è®¿é—®ï¼ŒæŸ¥çœ‹è¿™é‡Œ

**å¦‚æœç›´æ¥ä½¿ç”¨IPè®¿é—®**ï¼ŒåŸŸåå¤„å°±è¾“å…¥`ä½ çš„æœºå™¨IPåŠ ä¸€ä¸ªç«¯å£å·`

æ ¼å¼`ip:port`ï¼Œä¾‹å¦‚`39.156.66.18:3333`

:::warning ä½¿ç”¨IP+ç«¯å£æ³¨æ„äº‹é¡¹
éœ€åœ¨è‡ªå·±æœåŠ¡å™¨çš„`é˜²ç«å¢™`ä¸­å¼€æ”¾ä½¿ç”¨çš„ç«¯å£

ä¾‹å¦‚`ç¬”è€…`çš„è…¾è®¯äº‘

![](https://img.cdn.sugarat.top/mdImg/MTY0NzY5Mjk1NDI4OA==647692954288)

ä¸å¼€æ”¾å¯¹åº”ç«¯å£çš„è¯ï¼Œæ˜¯æ— æ³•é€šè¿‡å¤–ç½‘è¿›è¡Œè®¿é—®çš„

:::

### 2.2 ä¸€é”®éƒ¨ç½²å‰ç«¯

å®šä½åˆ°ç½‘ç«™æ‰€åœ¨ç›®å½•ï¼Œç„¶åç‚¹å‡»ç»ˆç«¯

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5MjUxNzc0NA==676792517744)

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5MjYwNzcyMA==676792607720)

æ‰§è¡Œä¸‹è¿°æŒ‡ä»¤ï¼šéƒ¨ç½²å®¢æˆ·ç«¯ï¼Œé»˜è®¤é€‰æ‹©æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬å³å¯

```sh
q ep deploy
```

![](https://cdn.upyun.sugarat.top/mdImg/sugar/7e7fcc04084ca592e9cd59dbda20367b)

:::tip ç»ˆç«¯å±•ç¤ºå¦‚ä¸‹

```sh
q ep deploy

â”Œ   éƒ¨ç½² EasyPicker é¡¹ç›®
â”‚
â—†  é€‰æ‹©éƒ¨ç½²ç«¯
â”‚  â— å®¢æˆ·ç«¯ - client
â”‚  â—‹ æ•°æ®åº“ - mysql
â”‚  â—‹ æœåŠ¡ç«¯ - server
â””
```

:::details äº¤äº’å¼éƒ¨ç½²ç»“æœ

```sh
â”Œ   éƒ¨ç½² EasyPicker é¡¹ç›®
â”‚
â—‡  é€‰æ‹©éƒ¨ç½²ç«¯
â”‚  å®¢æˆ·ç«¯ - client
â”‚
â—‡  é€‰æ‹©éƒ¨ç½²ç‰ˆæœ¬
â”‚  ç¨³å®šç‰ˆ - latest
â”‚
â—‡  é€‰æ‹©å…·ä½“ç‰ˆæœ¬
â”‚  2.5.0
â”‚
â—‡  èµ„æºåŒ…æ‹‰å–å®Œæˆ (easypicker2-client-2.5.0.tgz)
â”‚
â—‡  èµ„æºè§£å‹å®Œæˆï¼ˆç›®å½•ï¼š./distï¼‰
â”‚
â””  éƒ¨ç½²å®Œæˆï¼ğŸ‰ï¼Œè®°å¾—è®¾ç½® nginx è®¿é—®ç›®å½•ä¸º dist ç›®å½•

```

:::

:::details æˆ‘çš„è„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ

- å¦‚æœç”±äºç›®å½•å†²çªï¼Œå¯¼è‡´è„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Œè¯·æ‰‹åŠ¨åˆ é™¤`dist`ç›®å½•
- å…¶å®ƒé—®é¢˜ï¼Œ[åŠ åé¦ˆç¾¤](./../author.md)æˆ–è€…[è”ç³»ä½œè€…](./../author.md)æ²Ÿé€š
  :::

### 2.3 ä¿®æ”¹ç½‘ç«™è®¿é—®ç›®å½•

æŒ‰ç…§å›¾ç¤ºï¼Œä¿®æ”¹è®¿é—®ç›®å½•ä¸º `dist`

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5MzU3Mjg4OA==676793572888)

è®¿é—® http://ep.demo.sugarat.top æµ‹è¯•,å°±çœ‹åˆ°å’±ä»¬çš„å‰ç«¯åº”ç”¨äº†

æ­¤æ—¶è®¿é—®å¯ä»¥çœ‹åˆ°ï¼Œé¡µé¢ä¼šæœ‰ä¸€ä¸ªæŠ¥é”™æç¤º

é‚£æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰é…ç½®åç«¯æœåŠ¡ï¼Œåé¢ä¼šæœ‰é…ç½®çš„æµç¨‹

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5MzY0MjgwMw==676793642803)

### 2.4 å¼€å¯HTTPS

ä¸ºç½‘ç«™æ·»åŠ `SSL`è¯ä¹¦ï¼Œå¼€å¯ HTTPS è®¿é—®

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5Mzg1OTM0Mw==676793859343)

:::tip æ¸©é¦¨æç¤º
å®å¡”æä¾›äº†å…è´¹SSLè¯ä¹¦ç‚¹å‡»ç”³è¯·å³å¯ï¼Œæ”¶é›†çš„ä¿¡æ¯è‡ªå·±ä¸€é¡¿çå¡«å°±è¡Œ

ç”³è¯·å®Œç„¶åç‚¹å‡»å¯¹åº”è¯ä¹¦çš„éƒ¨ç½²æŒ‰é’®å³å¯

éƒ¨ç½²å®Œæˆåï¼Œï¼ˆå¯é€‰ï¼‰ç‚¹å‡»å³ä¸Šè§’å¼€å¯`å¼ºåˆ¶HTTPS`ï¼Œè®¿é—®`HTTP`å°†ä¼šå¼ºåˆ¶è·³è½¬åˆ°`HTTPS`
:::

::: danger ä¸€äº›å®å˜±
æ¨èç»™è‡ªå·±ç½‘ç«™é…ä¸Š `å¼ºåˆ¶HTTPS` ä¿è¯ç½‘ç«™çš„å®‰å…¨æ€§

ä¼˜å…ˆæ¨èä½¿ç”¨`æµ‹è¯•è¯ä¹¦`ï¼Œæœ‰æ•ˆæœŸæ›´é•¿ï¼ˆåˆ°æœŸåœ¨ç”³è¯·å³å¯ï¼Œæœ‰æ•°é‡é™åˆ¶ï¼‰

`Let's Encrypt`ï¼Œæ²¡ä»€ä¹ˆé™åˆ¶ï¼Œä¸ç”¨å¡«èµ„æ–™ï¼Œå¯ä»¥åšåˆ°è‡ªåŠ¨åŒ–ï¼Œåªæ˜¯æ—¶é—´çŸ­ä¸€ç‚¹ 90å¤©æœ‰æ•ˆ éœ€è¦é¢‘ç¹æ›´æ¢

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5NDI5Mjk3Mw==676794292973)

å½“ç„¶ä¸€èˆ¬è…¾è®¯äº‘/é˜¿é‡Œäº‘æœåŠ¡å™¨ä¹Ÿæœ‰æä¾›å…è´¹çš„SSLè¯ä¹¦ï¼Œè¯¦è§å„å‚å•†æ–‡æ¡£
:::

### 2.5 å¯¼å…¥æ•°æ®åº“è¡¨æ•°æ®

å’±ä»¬å‰é¢åœ¨åˆ›å»ºç«™ç‚¹çš„æ—¶å€™å·²ç»åˆ›å»ºäº†æ•°æ®åº“ï¼Œè¿™ä¸€æ­¥åªéœ€è¦åšè¡¨æ•°æ®çš„å¯¼å…¥

::: details å‰é¢å¿˜äº†åˆ›å»ºæ•°æ®åº“å’‹åŠï¼Ÿå¦‚ä½•è¿›è¡Œæ‰‹åŠ¨åˆ›å»ºï¼Ÿ
![](https://img.cdn.sugarat.top/mdImg/MTY1NjM4MTUzNDExMA==656381534110)

åœ¨æ•°æ®åº“é¢æ¿ï¼Œç‚¹å‡»æ·»åŠ æ•°æ®åº“

![](https://img.cdn.sugarat.top/mdImg/MTY0NzY1MjU0MDYwNg==647652540606)

:::danger æ³¨æ„äº‹é¡¹!!!

- **å¯†ç æ¨èä½¿ç”¨éšæœºçš„ï¼Œè¾“å…¥æ•°æ®åº“åå­—å³å¯ï¼ˆè´¦å·é»˜è®¤å’Œæ•°æ®åº“åä¸€è‡´ï¼‰**
- **æ•°æ®åº“åè®°å¾—å°å†™**
  :::

```sh
q ep deploy
```

![](https://cdn.upyun.sugarat.top/mdImg/sugar/4df2acc73f022b05fd77f32688d7f1fa)

:::tip ç»ˆç«¯å±•ç¤ºå¦‚ä¸‹

```sh
q ep deploy

â”Œ   éƒ¨ç½² EasyPicker é¡¹ç›®
â”‚
â—†  é€‰æ‹©éƒ¨ç½²ç«¯
â”‚  â—‹ å®¢æˆ·ç«¯ - client
â”‚  â— æ•°æ®åº“ - mysql
â”‚  â—‹ æœåŠ¡ç«¯ - server
â””
```

:::details äº¤äº’å¼éƒ¨ç½²ç»“æœ

```sh
â”Œ   éƒ¨ç½² EasyPicker é¡¹ç›®
â”‚
â—‡  é€‰æ‹©éƒ¨ç½²ç«¯
â”‚  æ•°æ®åº“ - mysql
â”‚
â—‡  è¯·è¾“å…¥æ•°æ®åº“åç§°
â”‚  ep_test2_sugarat
â”‚
â—‡  è¯·è¾“å…¥æ•°æ®åº“ç”¨æˆ·å
â”‚  ep_test2_sugarat
â”‚
â—‡  è¯·è¾“å…¥æ•°æ®åº“å¯†ç 
â”‚  xxxxxxx
â”‚
â—‡  å†æ¬¡ç¡®è®¤ä¸Šè¿°å½•å…¥çš„æ•°æ®åº“ä¿¡æ¯æ˜¯å¦æ­£ç¡®ï¼Ÿ
â”‚  Yes
â”‚
â—‡  è¡¨å¯¼å…¥å®Œæˆ
Tables_in_ep_test2_sugarat
category
files
people
task
task_info
user

mysql: [Warning] Using a password on the command line interface can be insecure.

â”‚
â—‡  âœ… å®Œæˆ user-config.json æ£€æŸ¥
â”‚
â—‡  âœ… æ•°æ®åº“é…ç½®å®Œæˆå†™å…¥
â”‚
â””  mysql æ•°æ®è¡¨åˆå§‹åŒ–å®Œæˆï¼ğŸ‰

```

:::

::: details æˆ‘å¿˜äº†æ•°æ®åº“è´¦å·ï¼Œå¯†ç ç­‰ç­‰ï¼Ÿå¯ä»¥åœ¨å“ªçœ‹ï¼Ÿ
åœ¨æ•°æ®åº“é¢æ¿é‡Œå°±èƒ½æ‰¾åˆ°æˆ‘ä»¬åˆ›å»ºçš„æ•°æ®åº“

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5NDk3ODc1Mw==676794978753)

ç‚¹å‡»å°çœ¼ç›å°±èƒ½çœ‹è§å¯†ç 
:::

è¿™æ ·`6`å¼ è¡¨ï¼Œå°±ç›´æ¥åˆå§‹åŒ–å®Œæˆå•¦

:::details æ‰‹åŠ¨å¯¼å…¥sqlï¼Ÿ
sql è„šæœ¬å¯ä»¥å‰å¾€ Github æŸ¥çœ‹

https://github.com/ATQQ/easypicker2-server/blob/master/docs/sql/auto_create.sql
:::

## 3. éƒ¨ç½²åç«¯æœåŠ¡

### 3.1 ä½¿ç”¨CLIéƒ¨ç½²

å®šä½åˆ°ç½‘ç«™æ‰€åœ¨ç›®å½•ï¼Œç„¶åç‚¹å‡»ç»ˆç«¯

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5MjUxNzc0NA==676792517744)

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5MjYwNzcyMA==676792607720)

æ‰§è¡Œä¸‹è¿°æŒ‡ä»¤ï¼Œè‡ªåŠ¨å®ŒæˆæœåŠ¡çš„èµ„æºæ‹‰å–å’Œå¯åŠ¨

```sh
q ep deploy
```

![](https://cdn.upyun.sugarat.top/mdImg/sugar/b5898c38c6823ec4aa023311b332162c)

:::tip ç»ˆç«¯å±•ç¤ºå¦‚ä¸‹

```sh
q ep deploy

â”Œ   éƒ¨ç½² EasyPicker é¡¹ç›®
â”‚
â—†  é€‰æ‹©éƒ¨ç½²ç«¯
â”‚  â—‹ å®¢æˆ·ç«¯ - client
â”‚  â—‹ æ•°æ®åº“ - mysql
â”‚  â— æœåŠ¡ç«¯ - server
â””
```

:::details äº¤äº’å¼éƒ¨ç½²ç»“æœ

```sh
â”Œ   éƒ¨ç½² EasyPicker é¡¹ç›®
â”‚
â—‡  é€‰æ‹©éƒ¨ç½²ç«¯
â”‚  æœåŠ¡ç«¯ - server
â”‚
â—‡  é€‰æ‹©éƒ¨ç½²ç‰ˆæœ¬
â”‚  ç¨³å®šç‰ˆ - latest
â”‚
â—‡  é€‰æ‹©å…·ä½“ç‰ˆæœ¬
â”‚  2.7.1
â”‚
â—‡  èµ„æºåŒ…æ‹‰å–å®Œæˆ (easypicker2-server-2.7.1.tgz)
â”‚
â—‡  èµ„æºè§£å‹å®Œæˆï¼ˆç›®å½•ï¼š./easypicker2-serverï¼‰
â”‚
â—‡  ä¾èµ–å®‰è£…å®Œæˆ (use pnpm)
```

:::

å¦‚æœæ²¡æœ‰æç¤º `éƒ¨ç½²å®Œæˆï¼ğŸ‰ï¼Œè®°å¾—é…ç½®åå‘ä»£ç†` åˆ™éœ€æ‰‹åŠ¨å®Œæˆåç»­æ­¥éª¤ï¼

![](https://cdn.upyun.sugarat.top/mdImg/sugar/5eaad999c6dad95e60523021d67ce378)

```sh
# å®šä½åˆ° easypicker2-server ç›®å½•
cd easypicker2-server

# å®‰è£…ä¾èµ–
pnpm install

# ä½¿ç”¨ pm2 å¯åŠ¨æœåŠ¡

pm2 start npm --name ep2-server -- run start
```

![](https://cdn.upyun.sugarat.top/mdImg/sugar/d36c58955c4eef441a363ae77319002b)

:::details æˆ‘çš„è„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ

- å¦‚æœç”±äºç›®å½•å†²çªï¼Œå¯¼è‡´è„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Œè¯·æ‰‹åŠ¨åˆ é™¤`easypicker2-server/dist`ç›®å½•
- å…¶å®ƒé—®é¢˜ï¼Œ[åŠ åé¦ˆç¾¤](./../author.md)æˆ–è€…[è”ç³»ä½œè€…](./../author.md)æ²Ÿé€š
  :::

### 3.2 è·å–ç«¯å£å’Œç®¡ç†é¢æ¿è´¦å·

é€šè¿‡æŸ¥è¯¢è¿è¡Œæ—¥å¿—å¯ä»¥å¾—åˆ°æ­¤ä¿¡æ¯

```sh
# æŸ¥è¯¢ç›®æ ‡æœåŠ¡æœ€è¿‘ 100æ¡ è¾“å‡ºçš„å¸¸è§„æ—¥å¿—
pm2 log --out ep2-server --lines 100
```

åœ¨æœåŠ¡æ—¥å¿—é‡Œï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡ç›‘å¬çš„ç«¯å£ï¼Œå’Œè¿è¡Œæ‰“å°çš„logæ—¥å¿—æƒ…å†µ

![](https://cdn.upyun.sugarat.top/mdImg/sugar/2bfb15e872b3a3eee5032abd89c49e6f)

åœ¨æœåŠ¡æ—¥å¿—é‡Œï¼Œå¯ä»¥çœ‹åˆ°ç®¡ç†é¢æ¿çš„è´¦å·å¯†ç 

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5NjUwNzU4OA==676796507588)

:::danger æ‹¿å°æœ¬æœ¬è®°ä¸‹è¿™ä¸ªè´¦å·å¯†ç åé¢ä¼šç”¨åˆ°ï¼ï¼ï¼
:::

:::details å…¶å®ƒè·å–æ–¹å¼ï¼Ÿ
åœ¨ easypicker2-server ç›®å½•ä¸‹ï¼Œæ‰¾åˆ°`user-config.json`æ–‡ä»¶ï¼Œé‡Œé¢å¯ä»¥çœ‹åˆ°ç›®æ ‡çš„é…ç½®

![](https://cdn.upyun.sugarat.top/mdImg/sugar/4efb67e389357a6015b488b6c1922a8d)

å› æ­¤ä½ ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œé¢ä¿®æ”¹
:::

### 3.3 pm2 å¸¸ç”¨æ“ä½œ

æŸ¥çœ‹æœåŠ¡åˆ—è¡¨

```sh
pm2 ls
```

å¯åŠ¨ ep-server æ–°æœåŠ¡

```sh
pm2 start npm --name è‡ªå®šä¹‰çš„æœåŠ¡å -- run start
```

é‡å¯æŒ‡å®šæœåŠ¡

```sh
pm2 restart ç›®æ ‡çš„æœåŠ¡å
```

æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—

```sh
pm2 log ç›®æ ‡çš„æœåŠ¡å

# è¾“å‡ºæœ€è¿‘ 100æ¡ è¾“å‡ºçš„å¸¸è§„æ—¥å¿—
pm2 log --out ç›®æ ‡çš„æœåŠ¡å --lines 100

# è¾“å‡ºæœ€è¿‘ 100æ¡ è¾“å‡ºçš„é”™è¯¯æ—¥å¿—
pm2 log --err ç›®æ ‡çš„æœåŠ¡å --lines 100
```

## 4 é…ç½® Nginx

### 4.1 æ·»åŠ åå‘ä»£ç†

æ‰“å¼€ç½‘ç«™çš„è®¾ç½®é¢æ¿ï¼Œç‚¹å‡»æ·»åŠ åå‘ä»£ç†ï¼Œå‹¾é€‰`é«˜çº§åŠŸèƒ½`

![](https://cdn.upyun.sugarat.top/mdImg/sugar/9c8acc3c31a141a5434b4ca191196652)

:::danger é‡è¦æç¤ºï¼Œè¯·ä¸€å®šæŒ‰ç…§æŒ‡ç¤ºè¿›è¡Œæ“ä½œï¼ï¼ï¼
ä»£ç†åç§°éšä¾¿å¡«

- ä»£ç†ç›®å½•`/api/`
- ç›®æ ‡ URL å¡«`è‡ªå·±çš„åç«¯æœåŠ¡åœ°å€`ï¼Œä¾‹å¦‚`http://127.0.0.1:3000/`
  - æœ«å°¾ä¸€å®šè¦å¸¦`/`
- å†…å®¹æ›¿æ¢`/api`,ç¬¬äºŒä¸ªç•™ç©º
  :::

::: details æç¤º ä¼ªé™æ€/nginxä¸»é…ç½®/vhost/æ–‡ä»¶å·²ç»å­˜åœ¨å…¨å±€åå‘ä»£ç†ï¼Ÿï¼Œæ— æ³•æ·»åŠ ï¼Œè¯·æˆ³è¿™é‡ŒæŸ¥çœ‹è§£æ³•

è¿›å…¥æ­¤ç›®å½•æ‰¾åˆ°åå‘ä»£ç†çš„é…ç½®æ–‡ä»¶

```sh
/www/server/panel/vhost/nginx/proxy/ä½ çš„åŸŸå
```

![](https://img.cdn.sugarat.top/mdImg/MTY1NjM4MjE4Mzc1Mw==656382183753)

å¦‚æœæ‰¾ä¸åˆ°å¯ä»¥å°è¯•æ‰‹åŠ¨ç›´æ¥æ·»åŠ ä¸‹é¢çš„ç¤ºä¾‹é…ç½®åˆ°é…ç½®æ–‡ä»¶ä¸­

ç¤ºä¾‹é…ç½®

```sh
#PROXY-START/api

location ^~ /api/
{
    # æ­¤å¤„çš„æœåŠ¡ç«¯å£æ”¹æˆä½ çš„æœåŠ¡åœ°å€ï¼Œå¯èƒ½3000ä¹Ÿå¯èƒ½æ˜¯3001
    # æ­¤å¤„çš„æœåŠ¡ç«¯å£æ”¹æˆä½ çš„æœåŠ¡åœ°å€ï¼Œé€šè¿‡ pm2 logsæŒ‡ä»¤ æŸ¥çœ‹æœåŠ¡å¯åŠ¨ç›‘å¬çš„ç«¯å£
    # æ­¤å¤„çš„æœåŠ¡ç«¯å£æ”¹æˆä½ çš„æœåŠ¡åœ°å€
    proxy_pass http://127.0.0.1:3000/;
    proxy_set_header Host 127.0.0.1;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header REMOTE-HOST $remote_addr;

    add_header X-Cache $upstream_cache_status;

    #Set Nginx Cache

    #proxy_set_header Accept-Encoding "";
    sub_filter "/api" "";
    sub_filter_once off;

    set $static_file6DkW7ygY 0;
    if ( $uri ~* "\.(gif|png|jpg|css|js|woff|woff2)$" )
    {
        set $static_file6DkW7ygY 1;
        expires 12h;
    }
    if ( $static_file6DkW7ygY = 0 )
    {
        add_header Cache-Control no-cache;
    }
}
#PROXY-END/api
```

![](https://cdn.upyun.sugarat.top/mdImg/sugar/a6fca12d85e484a660596f1543bdee45)
:::

**å¦‚ä»æ— æ³•è§£å†³ï¼Œå¯ä»¥é‡æ–°å°è¯•åˆ›å»ºä¸€ä¸ªæ–°ç«™ç‚¹ï¼Œé…ç½®å…ˆè¿›è¡Œåå‘ä»£ç†ï¼Œåœ¨åšå…¶å®ƒæ“ä½œã€‚å¦‚ä»ç„¶æ— æ³•è§£å†³å¯åŠ ç¾¤åé¦ˆã€‚**

å®Œæˆåå‘ä»£ç†çš„é…ç½®åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸Šé¢æä¾›çš„ç®¡ç†è´¦å·å’Œå¯†ç è¿›è¡ŒæœåŠ¡ç›¸å…³é…ç½®çš„æ›´æ–°äº†

### 4.2 æ·»åŠ é…ç½®é˜²æ­¢é¡µé¢ 404

**ä¸€å®šè¦åœ¨é…ç½®å®Œåå‘ä»£ç†ä¹‹åå†é…ç½®ï¼Œä¸ç„¶å®å¡”é¢æ¿æœ‰â€œä¼ªé™æ€â€é…ç½®æŠ¥é”™**

> å‚è€ƒ [vue-router å®˜æ–¹æ–‡æ¡£:æœåŠ¡å™¨é…ç½®ç¤ºä¾‹](https://router.vuejs.org/zh/guide/essentials/history-mode.html#%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B)

åœ¨å¯¹åº”ç½‘ç«™è®¾ç½®é¢æ¿ï¼Œç‚¹å‡»`é…ç½®æ–‡ä»¶`ï¼ŒåŠ å…¥ä»¥ä¸‹é…ç½®ã€‚ä¹Ÿå¯ä»¥æ·»åŠ åˆ° å®å¡”é¢æ¿çš„ â€œä¼ªé™æ€â€ é…ç½®é¡¹ä¸­ã€‚

:::code-group

```sh [nginx]
# vue-router
location / {
   try_files $uri $uri/ /index.html;
}
```

```sh [apache]
    <Directory "/www/wwwroot/ä½ çš„ç½‘ç«™åŸŸå/dist">
        SetOutputFilter DEFLATE
        Options FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html index.htm default.php default.html default.htm

        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /
            RewriteRule ^index\.html$ - [L]
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule . /index.html [L]
        </IfModule>
    </Directory>
```

:::

æ–¹å¼ 1(æ¨è)ï¼šä¼ªé™æ€é…ç½®é¡¹ç¤ºæ„ï¼š

![](https://cdn.upyun.sugarat.top/mdImg/sugar/2358eed4bbf45c92284f39e270c23b68)

æ–¹å¼ 2ï¼šç›´æ¥åŠ å…¥é…ç½®é¡¹é‡Œç¤ºæ„ï¼š

|                                  Nginx                                  | Apache |
| :---------------------------------------------------------------------: | :----: |
| ![](https://img.cdn.sugarat.top/mdImg/MTY0NzY5MzExMDgyMw==647693110823) |  TODO  |

## 5. æœ€åæ›´æ–°é…ç½®

1. è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™è¿›è¡Œç™»å½•
2. è¾“å…¥ä¸Šé¢æ‹¿åˆ°çš„è´¦å·å¯†ç 
3. åœ¨æ–°é¢æ¿ä¸­è¿›è¡Œç›¸åº”é…ç½®æ›´æ–°

![](https://img.cdn.sugarat.top/mdImg/MTY1OTkzOTEzNzg1Ng==659939137856)

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5OTQwNTY2Nw==676799405667)

:::details æ ‡çº¢çš„ä¸ºå¿…è¦æ›´æ–°çš„å­—æ®µ

- MySQL
  - æ•°æ®åº“å
  - ç”¨æˆ·å
  - å¯†ç 
- MongoDB
  - æ•°æ®åº“åï¼šä¾‹å¦‚ ep-prod,ep-test,ep-log
- ä¸ƒç‰›äº‘
  - AccessKey
  - SecretKey
  - å­˜å‚¨ç©ºé—´å
  - ç»‘å®šçš„åŸŸå
  - å­˜å‚¨åŒºåŸŸ
    :::

:::danger ä»å“ªè·å–è¿™äº›å˜é‡ï¼Ÿ

#### MySQL ç›¸å…³

MySQL çš„è´¦å·å¯†ç åœ¨æ•°æ®åº“é¢æ¿è·å–ï¼Œå³å‰é¢åˆ›å»ºçš„æ•°æ®åº“è´¦å·å¯†ç 

#### MongoDB

è¿™é‡Œåªéœ€è¦å¡«å…¥æ•°æ®åº“åï¼Œæ ¼å¼ `å°å†™+è¿å­—ç¬¦`

ä¾‹å¦‚ `ep-prod`, `ep-test`, `ep-log`

#### ä¸ƒç‰›äº‘ç›¸å…³é…ç½®

å‚è€ƒ[ä¸ƒç‰›äº‘OSSæœåŠ¡åˆ›å»º](./qiniu.md)æ–‡ç« ï¼Œè·å–ä¸ƒç‰›äº‘ç›¸å…³çš„å‡ ä¸ªç¯å¢ƒå˜é‡

#### è…¾è®¯äº‘ç›¸å…³é…ç½®ï¼ˆå¯é€‰ï¼‰

ä¸æ¥å…¥çŸ­ä¿¡ç™»å½•å¯ä»¥ä¸é…
:::

![](https://img.cdn.sugarat.top/mdImg/MTY1OTkzOTAyNDM2OA==659939024368)

æ›´æ–°å®Œç«‹é©¬ç”Ÿæ•ˆ

:::details å¦‚ä½•ä¸é€šè¿‡é¢æ¿ä¿®æ”¹é…ç½®ï¼Ÿ
åç«¯æœåŠ¡å¯åŠ¨åä¼šåˆ›å»ºä¸€ä¸ª user-config.json æ–‡ä»¶

![](https://img.cdn.sugarat.top/mdImg/MTY5Nzk2NTc3MjM0MQ==697965772341)

è¿™ä¸ª JSON æ–‡ä»¶é‡Œé¢å°±æ˜¯æˆ‘ä»¬çš„é…ç½®ä¿¡æ¯ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹

é…ç½®é¡¹æ ¼å¼å¦‚ä¸‹

```json
{
  "type": "mysql",
  "key": "host",
  "value": "localhost",
  "isSecret": false
}
```

ä¿®æ”¹åæŒ‰ä¸‹è¿°æ–¹å¼é‡å¯æœåŠ¡å³å¯
:::

å½“ç„¶ï¼Œä¸ºé¢„é˜²ä¸€äº›æ„å¤–æƒ…å†µï¼Œå¯ä»¥åœ¨éƒ½é…ç½®å®Œåï¼Œé€šè¿‡å¦‚ä¸‹æŒ‡ä»¤é‡å¯ä¸€ä¸‹æœåŠ¡

```sh
# æœåŠ¡åå¯ä»¥é€šè¿‡ pm2 ls æŸ¥çœ‹

pm2 restart æœåŠ¡å
```

![](https://cdn.upyun.sugarat.top/mdImg/sugar/3f1f3167da8dd55062ac068c4aaba0ef)

åˆ°æ­¤æ‰€æœ‰çš„é…ç½®éƒ½æå®šäº†ï¼Œáƒ¦( Â´ï½¥á´—ï½¥` )æ¯”å¿ƒã€‚æ„Ÿè°¢èµ–å¿ƒé˜…è¯»

## 99. å…¶ä½™åŠŸèƒ½

### å¼€å¯å†…å®¹å‹ç¼©

åœ¨ä¹‹å‰æ·»åŠ çš„åå‘ä»£ç†é…ç½®é‡Œ

æ·»åŠ `#`æ³¨é‡Šæˆ–è€…åˆ æ‰ `proxy_set_header Accept-Encoding "";`

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5Nzk5MzUwMw==676797993503)

![](https://img.cdn.sugarat.top/mdImg/MTY0NzY5MzM2MDI3OQ==647693360279)

è¿™æ ·è¿”å›çš„å†…å®¹ä¼šè¿›è¡Œå‹ç¼©ï¼Œå“åº”é€Ÿåº¦ä¼šæœ‰æ‰€æå‡

![](https://img.cdn.sugarat.top/mdImg/MTY3Njc5ODAzNDkxMw==676798034913)

![](https://img.cdn.sugarat.top/mdImg/MTY0NzY5Mzg3MDc2NA==647693870764)

### é…ç½®ç®¡ç†å‘˜æƒé™

è´¦å·åŠ äº†ç®¡ç†å‘˜æƒé™åï¼Œå°±èƒ½çœ‹åˆ°åå°ç®¡ç†çš„å…¥å£

- æŸ¥çœ‹è®¿é—®æ—¥å¿—
- ç®¡ç†ç”¨æˆ·è´¦å·

| æ·»åŠ å‰                                                                  | æ·»åŠ å                                                                  |
| ----------------------------------------------------------------------- | ----------------------------------------------------------------------- |
| ![](https://img.cdn.sugarat.top/mdImg/MTY0NzY5NDAzOTMxNg==647694039316) | ![](https://img.cdn.sugarat.top/mdImg/MTY0NzY5NDMxMDE1OA==647694310158) |

æ‰“å¼€å¯¹åº”çš„æ•°æ®åº“

![](https://img.cdn.sugarat.top/mdImg/MTY0NzY5NDE5NTQyMA==647694195420)

é€‰æ‹©`user`è¡¨

![](https://img.cdn.sugarat.top/mdImg/MTY0NzY5NDI0NjM5Ng==647694246396)

ä¿®æ”¹è´¦å·çš„`power`å­—æ®µå€¼ä¸º`0`

![](https://img.cdn.sugarat.top/mdImg/MTY0NzY5NDE1NTczMg==647694155732)

ç„¶åé‡æ–°ç™»å½•è´¦å·ï¼Œå°±èƒ½çœ‹åˆ°å…¥å£äº†

![](https://img.cdn.sugarat.top/mdImg/MTY0NzY5NDMxMDE1OA==647694310158)

å¤§åŠŸå‘Šæˆ

æœ‰å…¶å®ƒé—®é¢˜å¯ä»¥å°ç¾¤äº¤æµï¼Œæ–¹ä¾¿å¯ä»¥åŠ å…¥åŠæ—¶äº¤æµæ²Ÿé€šé—®é¢˜: 685446473

![](https://img.cdn.sugarat.top/mdImg/MTY0Nzc1MjI3MzUwMw==647752273503)
